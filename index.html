<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>40x20 Futsal</title>

<style>
*{box-sizing:border-box;font-family:system-ui}
body{margin:0;background:#f1f3f6}
header{background:#071b33;padding:24px;text-align:center}
header img{width:140px}
header p{color:#cfd8e6;font-style:italic;margin-top:8px}
.container{padding:20px}
.view{display:none}
.btn{
background:#fff;padding:16px;border-radius:16px;margin-bottom:12px;
font-weight:600;box-shadow:0 6px 18px rgba(0,0,0,.1);cursor:pointer
}
.btn-dark{background:#071b33;color:#fff}
.btn-small{padding:8px;font-size:13px;margin-top:6px}
.card{
background:#fff;padding:16px;border-radius:16px;
box-shadow:0 6px 18px rgba(0,0,0,.1);margin-bottom:14px
}
input,select,textarea{
width:100%;padding:12px;border-radius:12px;
border:1px solid #ccc;margin-bottom:10px
}
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{padding:6px;text-align:center}
th{background:#e8eef6}
.team{display:flex;align-items:center;gap:6px}
.team img{width:22px;height:22px;border-radius:50%}
.carousel{display:flex;gap:12px;overflow-x:auto}
.item{min-width:220px;background:#fff;padding:14px;border-radius:14px}
</style>
</head>

<body>

<header>
<img src="IMG_3936.png">
<p>Futsal: la pasión que nos une</p>
</header>

<div class="container">

<!-- HOME -->
<div id="home" class="view">
<div class="btn btn-dark" onclick="show('torneos')">TORNEOS</div>

<h3>NOTICIAS</h3>
<div class="carousel" id="news"></div>

<h3>SPONSORS</h3>
<div class="carousel" id="sponsors"></div>

<div class="btn" onclick="show('login')">PANEL</div>
</div>

<!-- TORNEOS -->
<div id="torneos" class="view">
<div class="btn btn-dark" onclick="show('home')">← Volver</div>
<div class="btn" onclick="openTorneo('LPF')">LPF</div>
<div class="btn" onclick="openTorneo('LAAMBA')">LAAMBA</div>
<div class="btn" onclick="openTorneo('APOFUSA')">A.Po.Fu.Sa</div>
</div>

<!-- MENU TORNEO -->
<div id="menuTorneo" class="view">
<div class="btn btn-dark" onclick="show('torneos')">← Volver</div>
<div class="btn" onclick="showTabla()">Tabla</div>
<div class="btn" onclick="showFixture()">Fixture / Resultados</div>
<div class="btn" onclick="showGoleadores()">Goleadores</div>
<div class="btn" onclick="showSanciones()">Sanciones</div>
</div>

<!-- CONTENIDO -->
<div id="contenido" class="view">
<div class="btn btn-dark" onclick="show('menuTorneo')">← Volver</div>
<div id="content"></div>
</div>

<!-- LOGIN -->
<div id="login" class="view">
<input id="user" placeholder="Usuario">
<input id="pass" type="password" placeholder="Contraseña">
<div class="btn btn-dark" onclick="login()">Entrar</div>
<div class="btn" onclick="show('home')">Volver</div>
</div>

<!-- PANEL -->
<div id="panel" class="view">
<div class="btn btn-dark" onclick="show('home')">← Volver</div>

<div id="adminOnly">

<div class="card">
<h3>Árbitros</h3>
<input id="arbUser" placeholder="Usuario">
<input id="arbPass" placeholder="Contraseña">
<div class="btn" onclick="addArbitro()">Agregar árbitro</div>
</div>

<div class="card">
<h3>Equipos</h3>
<input id="teamName" placeholder="Nombre del equipo">
<input type="file" id="teamLogo" accept="image/*">
<div class="btn" onclick="addTeam()">Agregar equipo</div>
</div>

<div class="card">
<h3>Noticias</h3>
<input id="newsTxt" placeholder="Texto">
<div class="btn" onclick="addNews()">Agregar</div>
</div>

<div class="card">
<h3>Sponsors</h3>
<input type="file" id="sponsorImg" accept="image/*">
<div class="btn" onclick="addSponsor()">Agregar</div>
</div>

</div>

<div class="card">
<h3>Partido</h3>
<input type="number" id="fecha" placeholder="Fecha">
<select id="local"></select>
<select id="visitante"></select>
<input type="number" id="gLocal" placeholder="Goles local">
<input type="number" id="gVisita" placeholder="Goles visita">
<textarea id="goleadoresTxt" placeholder="Ej: Juan(2), Pedro(1)"></textarea>
<div class="btn btn-dark" onclick="saveMatch()">Guardar / Editar</div>
</div>

<div class="card">
<h3>Sanciones</h3>
<input id="sanJugador" placeholder="Jugador">
<input id="sanEquipo" placeholder="Equipo">
<input id="sanFechas" placeholder="Fechas">
<div class="btn" onclick="addSan()">Agregar</div>
</div>

<div class="card">
<div class="btn" onclick="exportData()">Exportar</div>
<input type="file" onchange="importData(event)">
</div>
</div>

</div>

<script>
let torneoActual='',role='',editingId=null
let data=JSON.parse(localStorage.getItem('data'))||{
users:[{u:'admin',p:'admin123',r:'admin'}],
equipos:[],partidos:[],goleadores:[],sanciones:[],news:[],sponsors:[]
}

function save(){localStorage.setItem('data',JSON.stringify(data))}
function show(id){document.querySelectorAll('.view').forEach(v=>v.style.display='none');document.getElementById(id).style.display='block'}
show('home')

function openTorneo(t){torneoActual=t;show('menuTorneo')}

function login(){
let f=data.users.find(x=>x.u===user.value&&x.p===pass.value)
if(!f)return alert('Error')
role=f.r
adminOnly.style.display=role==='admin'?'block':'none'
loadTeams()
show('panel')
}

function addArbitro(){data.users.push({u:arbUser.value,p:arbPass.value,r:'arbitro'});save();alert('OK')}
function addTeam(){
let r=new FileReader()
r.onload=e=>{
data.equipos.push({name:teamName.value,logo:e.target.result,pj:0,gf:0,gc:0,pts:0})
save();loadTeams()
}
r.readAsDataURL(teamLogo.files[0])
}

function loadTeams(){
local.innerHTML=visitante.innerHTML=''
data.equipos.forEach(e=>{
local.innerHTML+=`<option>${e.name}</option>`
visitante.innerHTML+=`<option>${e.name}</option>`
})
}

function saveMatch(){
let gl=+gLocal.value,gv=+gVisita.value
let id=editingId||Date.now()
data.partidos=data.partidos.filter(p=>p.id!==id)
data.partidos.push({id,fecha:+fecha.value,local:local.value,visita:visitante.value,gl,gv,goleadores:goleadoresTxt.value})
recalc()
editingId=null
save()
alert('Guardado')
}

function recalc(){
data.equipos.forEach(e=>{e.pj=0;e.gf=0;e.gc=0;e.pts=0})
data.goleadores=[]
data.partidos.forEach(p=>{
let l=data.equipos.find(e=>e.name===p.local)
let v=data.equipos.find(e=>e.name===p.visita)
l.pj++;v.pj++
l.gf+=p.gl;l.gc+=p.gv
v.gf+=p.gv;v.gc+=p.gl
if(p.gl>p.gv)l.pts+=3
else if(p.gv>p.gl)v.pts+=3
else{l.pts++;v.pts++}
p.goleadores.split(',').forEach(g=>{
let m=g.match(/(.+)\((\d+)\)/)
if(m){
let ex=data.goleadores.find(x=>x.n===m[1])
if(ex)ex.g+=+m[2]
else data.goleadores.push({n:m[1],g:+m[2]})
}
})
})
}

function showFixture(){
let html=''
data.partidos.sort((a,b)=>a.fecha-b.fecha).forEach(p=>{
html+=`<div class="card"><b>Fecha ${p.fecha}</b><br>${p.local} ${p.gl}-${p.gv} ${p.visita}
<div class="btn btn-small" onclick="edit(${p.id})">Editar</div>
<div class="btn btn-small" onclick="copyPost(${p.id})">Copiar publicación</div></div>`
})
content.innerHTML=html;show('contenido')
}

function edit(id){
let p=data.partidos.find(x=>x.id===id)
editingId=id
fecha.value=p.fecha
local.value=p.local
visitante.value=p.visita
gLocal.value=p.gl
gVisita.value=p.gv
goleadoresTxt.value=p.goleadores
show('panel')
}

function showTabla(){
let html='<div class="card"><table><tr><th>Equipo</th><th>PJ</th><th>GF</th><th>GC</th><th>DG</th><th>PTS</th></tr>'
data.equipos.forEach(e=>{
html+=`<tr><td class="team"><img src="${e.logo}">${e.name}</td><td>${e.pj}</td><td>${e.gf}</td><td>${e.gc}</td><td>${e.gf-e.gc}</td><td><b>${e.pts}</b></td></tr>`
})
html+='</table></div>';content.innerHTML=html;show('contenido')
}

function showGoleadores(){
let html='<div class="card">'
data.goleadores.sort((a,b)=>b.g-a.g).forEach(g=>html+=`${g.n}: ${g.g}<br>`)
html+='</div>';content.innerHTML=html;show('contenido')
}

function addSan(){data.sanciones.push({j:sanJugador.value,e:sanEquipo.value,f:sanFechas.value});save()}
function showSanciones(){
let html='<div class="card">'
data.sanciones.forEach(s=>html+=`${s.j} (${s.e}) - ${s.f} fechas<br>`)
html+='</div>';content.innerHTML=html;show('contenido')
}

function addNews(){data.news.push(newsTxt.value);save();renderHome()}
function addSponsor(){
let r=new FileReader()
r.onload=e=>{data.sponsors.push(e.target.result);save();renderHome()}
r.readAsDataURL(sponsorImg.files[0])
}

function renderHome(){
news.innerHTML=data.news.map(n=>`<div class="item">${n}</div>`).join('')
sponsors.innerHTML=data.sponsors.map(s=>`<div class="item"><img src="${s}" width="100%"></div>`).join('')
}
renderHome()

function copyPost(id){
let p=data.partidos.find(x=>x.id===id)
navigator.clipboard.writeText(`Fecha ${p.fecha}\n${p.local} ${p.gl}-${p.gv} ${p.visita}`)
alert('Copiado')
}

function exportData(){
let a=document.createElement('a')
a.href=URL.createObjectURL(new Blob([JSON.stringify(data)]))
a.download='40x20.json'
a.click()
}
function importData(e){
let r=new FileReader()
r.onload=x=>{data=JSON.parse(x.target.result);save();location.reload()}
r.readAsText(e.target.files[0])
}
</script>

</body>
</html>
