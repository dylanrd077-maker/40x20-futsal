<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>40x20 Futsal</title>

<style>
*{box-sizing:border-box;font-family:system-ui,-apple-system,sans-serif}
body{margin:0;background:#f1f3f6;color:#111}

/* HEADER */
header{background:#071b33;padding:26px 20px;text-align:center}
header img{width:140px}
header p{margin-top:10px;color:#dbe4f0;font-style:italic}

/* CONTENEDOR */
.container{padding:20px}
.view{display:none}

/* BOTONES */
.btn{
background:#fff;border-radius:16px;padding:18px;margin-bottom:14px;
font-size:16px;font-weight:600;
box-shadow:0 8px 20px rgba(0,0,0,.08);
cursor:pointer
}
.btn-dark{background:#071b33;color:#fff}
.btn-small{padding:10px;font-size:14px}

/* TITULOS */
h3{margin:18px 0 12px}

/* INPUTS */
input,select{
width:100%;padding:12px;border-radius:12px;
border:1px solid #ccc;margin-bottom:10px
}

/* LISTAS */
.card{
background:#fff;padding:14px;border-radius:14px;
margin-bottom:10px
}

/* TABLAS */
table{width:100%;border-collapse:collapse}
th,td{padding:8px;text-align:center;font-size:14px}
th{background:#e7eef8}
</style>
</head>

<body>

<header>
<img src="IMG_3936.png">
<p>Futsal: la pasión que nos une</p>
</header>

<div class="container">

<!-- HOME -->
<div id="home">
<div class="btn btn-dark" onclick="go('torneos')">TORNEOS</div>
<div class="btn" onclick="go('login')">PANEL ADMIN</div>
</div>

<!-- TORNEOS -->
<div id="torneos" class="view">
<div class="btn btn-dark" onclick="back()">← Volver</div>
<div class="btn" onclick="selectTorneo('LPF')">LPF</div>
<div class="btn" onclick="selectTorneo('LAAMBA')">LAAMBA</div>
<div class="btn" onclick="selectTorneo('APOFUSA')">A.Po.Fu.Sa</div>
</div>

<!-- MENU -->
<div id="menu" class="view">
<div class="btn btn-dark" onclick="back()">← Volver</div>
<div class="btn" onclick="openSection('fixture')">Fixture</div>
<div class="btn" onclick="openSection('posiciones')">Tabla de posiciones</div>
<div class="btn" onclick="openSection('goleadores')">Goleadores</div>
</div>

<!-- FIXTURE -->
<div id="fixture" class="view">
<div class="btn btn-dark" onclick="back()">← Volver</div>
<h3 id="fixtureTitle"></h3>
<div id="fixtureList"></div>
</div>

<!-- POSICIONES -->
<div id="posiciones" class="view">
<div class="btn btn-dark" onclick="back()">← Volver</div>
<h3>Tabla de posiciones</h3>
<div id="tablaPosiciones"></div>
</div>

<!-- GOLEADORES -->
<div id="goleadores" class="view">
<div class="btn btn-dark" onclick="back()">← Volver</div>
<h3>Goleadores</h3>
<div id="tablaGoleadores"></div>
</div>

<!-- LOGIN -->
<div id="login" class="view">
<div class="btn btn-dark" onclick="back()">← Volver</div>
<input type="password" id="pass" placeholder="Contraseña admin">
<div class="btn btn-dark" onclick="login()">Ingresar</div>
</div>

<!-- ADMIN -->
<div id="admin" class="view">
<div class="btn btn-dark" onclick="back()">← Volver</div>

<h3>Equipos</h3>
<input id="teamName" placeholder="Nombre del equipo">
<input id="teamLogo" placeholder="URL del escudo">
<div class="btn btn-small" onclick="addTeam()">Agregar equipo</div>
<div id="teamsList"></div>

<h3>Partido + Goleadores</h3>
<input id="fecha" placeholder="Fecha">
<select id="local"></select>
<select id="visitante"></select>
<input id="gL" type="number" placeholder="Goles local">
<input id="gV" type="number" placeholder="Goles visitante">

<input id="jugador" placeholder="Nombre del goleador">
<select id="equipoGol"></select>
<input id="golesJugador" type="number" placeholder="Goles del jugador">

<div class="btn btn-small" onclick="addMatch()">Guardar partido</div>
<div id="adminFixture"></div>
</div>

</div>

<script>
let history=['home']
let torneoActual=''
const PASS='admin123'

const data=JSON.parse(localStorage.getItem('data')) || {
teams:{LPF:[],LAAMBA:[],APOFUSA:[]},
fixture:{LPF:[],LAAMBA:[],APOFUSA:[]},
goleadores:{LPF:[],LAAMBA:[],APOFUSA:[]}
}

function save(){localStorage.setItem('data',JSON.stringify(data))}

function go(id){
document.querySelectorAll('#home,.view').forEach(v=>v.style.display='none')
document.getElementById(id).style.display='block'
history.push(id)
}

function back(){
history.pop()
let last=history[history.length-1]
document.querySelectorAll('#home,.view').forEach(v=>v.style.display='none')
document.getElementById(last).style.display='block'
}

function selectTorneo(t){torneoActual=t;go('menu')}

function openSection(s){
if(s==='fixture'){renderFixture();go('fixture')}
if(s==='posiciones'){renderTabla();go('posiciones')}
if(s==='goleadores'){renderGoleadores();go('goleadores')}
}

function login(){
if(pass.value===PASS){loadAdmin();go('admin')}
else alert('Contraseña incorrecta')
}

function loadAdmin(){
renderTeams();renderSelects();renderAdminFixture()
}

function addTeam(){
data.teams[torneoActual].push({name:teamName.value,logo:teamLogo.value})
save();renderTeams();renderSelects()
}

function renderTeams(){
teamsList.innerHTML=''
data.teams[torneoActual].forEach(t=>{
teamsList.innerHTML+=`<div class="card">${t.name}</div>`
})
}

function renderSelects(){
local.innerHTML=visitante.innerHTML=equipoGol.innerHTML=''
data.teams[torneoActual].forEach(t=>{
local.innerHTML+=`<option>${t.name}</option>`
visitante.innerHTML+=`<option>${t.name}</option>`
equipoGol.innerHTML+=`<option>${t.name}</option>`
})
}

function addMatch(){
data.fixture[torneoActual].push({
fecha:fecha.value,local:local.value,visitante:visitante.value,
gL:+gL.value,gV:+gV.value
})

let g=data.goleadores[torneoActual]
let ex=g.find(x=>x.jugador===jugador.value)
if(ex) ex.goles+=+golesJugador.value
else g.push({jugador:jugador.value,equipo:equipoGol.value,goles:+golesJugador.value})

save();renderAdminFixture()
}

function renderAdminFixture(){
adminFixture.innerHTML=''
data.fixture[torneoActual].forEach(p=>{
adminFixture.innerHTML+=`<div class="card">${p.fecha}: ${p.local} ${p.gL}-${p.gV} ${p.visitante}</div>`
})
}

function renderFixture(){
fixtureTitle.innerText='Fixture '+torneoActual
fixtureList.innerHTML=''
data.fixture[torneoActual].forEach(p=>{
fixtureList.innerHTML+=`<div class="card"><b>${p.fecha}</b><br>${p.local} ${p.gL}-${p.gV} ${p.visitante}</div>`
})
}

function renderTabla(){
let t={}
data.teams[torneoActual].forEach(e=>t[e.name]={pj:0,pts:0,gf:0,gc:0})

data.fixture[torneoActual].forEach(p=>{
let L=t[p.local],V=t[p.visitante]
L.pj++;V.pj++
L.gf+=p.gL;L.gc+=p.gV
V.gf+=p.gV;V.gc+=p.gL
if(p.gL>p.gV)L.pts+=3
else if(p.gL<p.gV)V.pts+=3
else{L.pts++;V.pts++}
})

let rows=Object.entries(t).sort((a,b)=>b[1].pts-a[1].pts)
let html='<table><tr><th>#</th><th>Equipo</th><th>PJ</th><th>PTS</th></tr>'
rows.forEach((r,i)=>{
html+=`<tr><td>${i+1}</td><td>${r[0]}</td><td>${r[1].pj}</td><td>${r[1].pts}</td></tr>`
})
tablaPosiciones.innerHTML=html+'</table>'
}

function renderGoleadores(){
let g=[...data.goleadores[torneoActual]].sort((a,b)=>b.goles-a.goles)
let html='<table><tr><th>#</th><th>Jugador</th><th>Equipo</th><th>Goles</th></tr>'
g.forEach((x,i)=>{
html+=`<tr><td>${i+1}</td><td>${x.jugador}</td><td>${x.equipo}</td><td>${x.goles}</td></tr>`
})
tablaGoleadores.innerHTML=html+'</table>'
}
</script>

</body>
</html>
